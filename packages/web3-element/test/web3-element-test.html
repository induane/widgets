<html>
<head>
  <meta charset="utf-8">
  <script src="../node_modules/webcomponentsjs/full.js"></script>
  <script src="../node_modules/web-component-tester/browser.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js/dist/web3.min.js"></script>
  <script src="../node_modules/@openrelay/element-test-utils/dist/bundle.js"></script>
  <script src="../dist/bundle.js"></script>
</head>
<body>
  <or-web3 id="fixture">Content</or-web3>
  <script>
    suite('<or-web3>', function() {
      test('hasWeb3', function() {
        assert.isFalse(document.getElementById('fixture').hasWeb3);
        assert.equal(document.getElementById('fixture').getBoundingClientRect().width, 0);
      });
      test('hasWeb3', function(done) {
        var web3 = elementtestutils.getFakeWeb3();
        web3.eth.getAccounts(console.log);
        document.getElementById('fixture').dispatchEvent(new CustomEvent('set-web3', {detail: {web3: web3}, bubbles: false, composed: false}));
        assert.isTrue(document.getElementById('fixture').hasWeb3);
        setTimeout(function(){
          assert.isTrue(document.getElementById('fixture').getBoundingClientRect().width != 0);
          web3.currentProvider.stop();
          done();
        }, 10);
      });
      test('topAccount', function(done) {
        var web3 = elementtestutils.getFakeWeb3();
        document.getElementById('fixture').dispatchEvent(new CustomEvent('set-web3', {detail: {web3: web3}, bubbles: false, composed: false}));
        assert.isTrue(document.getElementById('fixture').hasWeb3);
        setTimeout(function(){
          assert.isTrue(document.getElementById('fixture').getBoundingClientRect().width != 0);
          assert.equal(document.getElementById('fixture').topAccount, '0xf00df00df00df00df00df00df00df00df00df00d');
          web3.currentProvider.stop();
          done();
        }, 1000);
      });
    });
  </script>
</body>
</html>
